import{b as w,u as S,a as F,r as d,j as e,L as h,y as o}from"./index-CDtZe3id.js";import{c as g}from"./carreraService-qtl1_GFQ.js";import{f as k}from"./facultadService-BYypkmnv.js";import{C as j}from"./CustomButton-BHk0TsfB.js";import{u as q}from"./index.esm-CYe7NKTW.js";import{o as D,c as L,a as u}from"./index.esm-DVNFl3iM.js";const A=L().shape({name:u().required("El nombre de la carrera es requerido"),description:u().nullable(),facultad:u().required("La facultad es requerida")}),G=()=>{const{id:n}=w(),p=S(),{hasRole:y}=F(),[s,t]=d.useState(!0),[f,N]=d.useState([]),[b,m]=d.useState(null),{register:x,handleSubmit:v,formState:{errors:c},setValue:l}=q({resolver:D(A)}),i=y(["admin"]);d.useEffect(()=>{(async()=>{if(!i){t(!1),m("No tienes permiso para editar carreras.");return}try{t(!0);const[r,E]=await Promise.all([g.getCarreraById(n),k.getFacultades()]);N(E),l("name",r.name),l("description",r.description||""),l("facultad",r.facultad._id),m(null)}catch(r){console.error("Error fetching carrera for edit:",r),m("No se pudo cargar la carrera para edición o las facultades."),o.error("Error al cargar la carrera o las facultades.")}finally{t(!1)}})()},[n,i,l]);const C=async a=>{if(!i){o.error("No tienes permiso para modificar carreras.");return}try{t(!0),await g.updateCarrera(n,a),o.success("Carrera actualizada exitosamente."),p("/admin/carreras")}catch(r){console.error("Error updating carrera:",r),o.error(r.response?.data?.message||"Error al actualizar la carrera.")}finally{t(!1)}};return s?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(h,{}),e.jsx("p",{className:"mt-4",children:"Cargando carrera para edición..."})]}):b?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:b})]}):i?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center w-full",children:"Editar Carrera"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-md mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:v(C),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"name",children:"Nombre de la Carrera:"}),e.jsx("input",{type:"text",id:"name",...x("name"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),c.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"description",children:"Descripción (opcional):"}),e.jsx("textarea",{id:"description",...x("description"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",rows:"3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"facultad",children:"Facultad:"}),e.jsx("select",{id:"facultad",...x("facultad"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:f.length===0?e.jsx("option",{value:"",children:"Cargando facultades..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecciona una facultad"}),f.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]})}),c.facultad&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:c.facultad.message})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(j,{variant:"secondary",className:"cursor-pointer",onClick:()=>p("/admin/carreras"),disabled:s,children:"Cancelar"}),e.jsx(j,{variant:"primary",className:"cursor-pointer",type:"submit",disabled:s,children:s?e.jsx(h,{}):"Guardar Cambios"})]})]})})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para editar carreras."})]})};export{G as default};
