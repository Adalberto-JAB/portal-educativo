import{u as q,a as F,r,j as e,L as N,C as u,D as x,y as f}from"./index-CDtZe3id.js";import{u as T}from"./index.esm-CYe7NKTW.js";import{o as $,c as z,a as p,b as A}from"./index.esm-DVNFl3iM.js";import{u as v}from"./userService-BeE_nVnS.js";import{C}from"./CustomButton-BHk0TsfB.js";const D=z().shape({currentPassword:p().required("La contraseña actual es requerida."),newPassword:p().required("La nueva contraseña es requerida.").min(6,"La nueva contraseña debe tener al menos 6 caracteres.").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/,"Debe contener una mayúscula, minúscula, un número y un carácter especial."),confirmPassword:p().oneOf([A("newPassword"),null],"Las contraseñas deben coincidir.").required("Confirmar la nueva contraseña es requerido.")}),Z=()=>{const h=q(),{user:c,loading:i}=F(),[t,S]=r.useState(null),[b,w]=r.useState(!1),[L,y]=r.useState(!0),[j,o]=r.useState(!1),[g,n]=r.useState(!1),[P,l]=r.useState(!1),{register:d,handleSubmit:E,formState:{errors:a}}=T({resolver:$(D)});r.useEffect(()=>{i||(async()=>{if(!c?.id){y(!1);return}try{const s=await v.getUserById(c.id);S(s)}catch(s){console.error("Error fetching profile:",s),f.error("No se pudo cargar la información del perfil.")}finally{y(!1)}})()},[c,i]);const M=async m=>{w(!0);try{const s=await v.changePassword({currentPassword:m.currentPassword,newPassword:m.newPassword});f.success(s.message||"Contraseña actualizada exitosamente."),h("/profile")}catch(s){console.error("Error changing password:",s),f.error(s.response?.data?.message||"Error al cambiar la contraseña.")}finally{w(!1)}};return L||i?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(N,{}),e.jsx("p",{className:"mt-4",children:"Cargando..."})]}):e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-md mx-auto border border-border-color",children:[t&&e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:t.profilePictureURL,alt:"Profile",className:"w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-accent-primary"}),e.jsxs("h2",{className:"text-2xl font-bold",children:[t.name," ",t.last_name]}),e.jsx("p",{className:"text-text-secondary",children:t.email})]}),e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"Cambiar Contraseña"}),e.jsxs("form",{onSubmit:E(M),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"currentPassword",children:"Contraseña Actual:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",id:"currentPassword",...d("currentPassword"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),e.jsx("button",{type:"button",onMouseDown:()=>o(!0),onMouseUp:()=>o(!1),onMouseLeave:()=>o(!1),onTouchStart:()=>o(!0),onTouchEnd:()=>o(!1),className:"absolute inset-y-0 right-0 px-3 flex items-center text-sm text-text-secondary",children:j?e.jsx(u,{}):e.jsx(x,{})})]}),a.currentPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.currentPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"newPassword",children:"Nueva Contraseña:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",id:"newPassword",...d("newPassword"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),e.jsx("button",{type:"button",onMouseDown:()=>n(!0),onMouseUp:()=>n(!1),onMouseLeave:()=>n(!1),onTouchStart:()=>n(!0),onTouchEnd:()=>n(!1),className:"absolute inset-y-0 right-0 px-3 flex items-center text-sm text-text-secondary",children:g?e.jsx(u,{}):e.jsx(x,{})})]}),a.newPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"confirmPassword",children:"Confirmar Nueva Contraseña:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:P?"text":"password",id:"confirmPassword",...d("confirmPassword"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),e.jsx("button",{type:"button",onMouseDown:()=>l(!0),onMouseUp:()=>l(!1),onMouseLeave:()=>l(!1),onTouchStart:()=>l(!0),onTouchEnd:()=>l(!1),className:"absolute inset-y-0 right-0 px-3 flex items-center text-sm text-text-secondary",children:P?e.jsx(u,{}):e.jsx(x,{})})]}),a.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.confirmPassword.message})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 mt-4",children:[e.jsx(C,{variant:"secondary",type:"button",className:"cursor-pointer",onClick:()=>h("/profile"),children:"Cancelar"}),e.jsx(C,{variant:"primary",type:"submit",className:"cursor-pointer",disabled:b,children:b?e.jsx(N,{size:"sm"}):"Actualizar Contraseña"})]})]})]})})};export{Z as default};
