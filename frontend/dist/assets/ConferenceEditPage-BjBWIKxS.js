import{u as q,b as F,a as R,r as n,j as e,L as y,y as m}from"./index-CDtZe3id.js";import{c as k}from"./conferenceService-Bcx88bEU.js";import{c as $}from"./coverService-mfvIq_ty.js";import{C}from"./CustomButton-BHk0TsfB.js";import{u as T,C as E}from"./index.esm-CYe7NKTW.js";import{o as O,c as _,a as l,d as A,f as V,e as D}from"./index.esm-DVNFl3iM.js";const B=_().shape({title:l().required("El título es requerido"),topic:l(),audience:l(),type:l().oneOf(["Presencial","Virtual"]).required("El tipo es requerido"),organizer:l().required("El nombre del organizador es requerido"),speakers:l(),startDate:l().required("La fecha es requerida"),duration:D().typeError("La duración debe ser un número").positive().integer().required(),cost:D().typeError("El costo debe ser un número").min(0).default(0),isFree:V(),coverImage:A().nullable(),url:l().url("Debe ser una URL válida"),phoneNumber:l()}),Y=()=>{const j=q(),{id:u}=F(),{user:S,hasRole:I}=R(),[i,x]=n.useState(!0),[p,g]=n.useState(null),[b,P]=n.useState(null),{register:t,handleSubmit:z,formState:{errors:r},watch:f,control:v,reset:N}=T({resolver:O(B)}),w=I(["admin","teacher"]),d=f("coverImage"),U=f("type")==="Virtual";n.useEffect(()=>{(async()=>{try{const s=await k.getConferenceById(u),o={...s,startDate:s.startDate?new Date(s.startDate).toISOString().slice(0,16):"",speakers:s.speakers?s.speakers.join(", "):""};N(o),s.cover&&s.cover._id&&P(`https://portal-educativo-jab.onrender.com/api/covers/${s.cover._id}`)}catch(s){m.error("Error al cargar los datos del congreso."),console.error(s)}finally{x(!1)}})()},[u,N]),n.useEffect(()=>{if(d&&d[0]){const a=d[0],s=URL.createObjectURL(a);return g(s),()=>URL.revokeObjectURL(s)}else g(null)},[d]);const L=async a=>{if(!w){m.error("No tienes permiso para editar congresos.");return}x(!0);try{let s=a.cover?._id;if(a.coverImage&&a.coverImage[0]){const c=new FormData;c.append("image",a.coverImage[0]),c.append("name",`conference_cover_${Date.now()}`),c.append("isGeneric","false"),c.append("idUser",S.id),s=(await $.createCover(c))._id}const o={...a,speakers:a.speakers?a.speakers.split(",").map(c=>c.trim()):[],cover:s||void 0};await k.updateConference(u,o),m.success("Congreso actualizado exitosamente."),j("/events")}catch(s){console.error("Error updating conference:",s),m.error(s.response?.data?.message||"Error al actualizar el congreso.")}finally{x(!1)}};return i?e.jsx("div",{className:"pt-20 flex justify-center items-center min-h-screen",children:e.jsx(y,{})}):w?e.jsx("div",{className:"mt-28 p-8 min-h-screen bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center w-full",children:"Editar Congreso/Evento"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-4xl mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:z(L),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Título"}),e.jsx("input",{...t("title"),className:"w-full input-class"}),r.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Tema/Tópico"}),e.jsx("input",{...t("topic"),className:"w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Dirigido a"}),e.jsx("input",{...t("audience"),className:"w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Organizador"}),e.jsx("input",{...t("organizer"),className:"w-full input-class"}),r.organizer&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.organizer.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Tipo"}),e.jsxs("select",{...t("type"),className:"w-full input-class",children:[e.jsx("option",{value:"Presencial",children:"Presencial"}),e.jsx("option",{value:"Virtual",children:"Virtual"})]})]}),U&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"URL del Evento"}),e.jsx("input",{...t("url"),className:"w-full input-class",placeholder:"https://ejemplo.com/evento"}),r.url&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.url.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Ponentes (separados por comas)"}),e.jsx("input",{...t("speakers"),className:"w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Teléfono de Contacto"}),e.jsx("input",{...t("phoneNumber"),className:"w-full input-class"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Fecha de Inicio"}),e.jsx("input",{type:"datetime-local",...t("startDate"),className:"w-full input-class"}),r.startDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.startDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Duración (en minutos)"}),e.jsx("input",{type:"number",...t("duration"),className:"w-full input-class"}),r.duration&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.duration.message})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("label",{className:"block text-sm font-bold",children:"¿Es Gratuito?"}),e.jsx(E,{name:"isFree",control:v,render:({field:a})=>e.jsx("input",{type:"checkbox",...a,checked:a.value,className:"h-5 w-5"})})]}),e.jsx(E,{name:"cost",control:v,render:({field:{onChange:a,value:s},fieldState:{error:o}})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Costo"}),e.jsx("input",{type:"number",value:s,onChange:a,disabled:f("isFree"),className:"w-full input-class disabled:bg-gray-600"}),o&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.message})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-2",children:"Imagen de Portada"}),b&&!p&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:"Portada actual:"}),e.jsx("img",{src:b,alt:"Portada Actual",className:"max-w-xs h-auto rounded-md shadow-md"})]}),e.jsxs("label",{className:"block text-sm font-bold mb-2",children:[b?"Cambiar Imagen":"Subir Imagen"," ","(Opcional)"]}),e.jsx("input",{type:"file",...t("coverImage"),accept:".png, .jpg, .jpeg",className:"w-full file-input"}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-2",children:"Previsualización de nueva imagen:"}),e.jsx("img",{src:p,alt:"Previsualización",className:"max-w-xs h-auto rounded-md shadow-md"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-4 mt-4",children:[e.jsx(C,{type:"button",onClick:()=>j("/events"),disabled:i,children:"Cancelar"}),e.jsx(C,{variant:"secondary",type:"submit",disabled:i,children:i?e.jsx(y,{}):"Actualizar Congreso"})]})]})})]})}):e.jsx("div",{className:"pt-20 p-8 text-center",children:e.jsx("h1",{className:"text-3xl font-bold text-red-500",children:"Acceso Denegado"})})},G=`
  .input-class { background-color: #2d3748; border: 1px solid #4a5568; color: #f7fafc; padding: 0.5rem 0.75rem; border-radius: 0.375rem; }
  .file-input { border-radius: 9999px; border-width: 0px; font-size: 0.875rem; font-weight: 600; background-color: #4299e1; color: white; }
  .file-input:hover { background-color: #2b6cb0; }
`,h=document.createElement("style");h.type="text/css";h.innerText=G;document.head.appendChild(h);export{Y as default};
