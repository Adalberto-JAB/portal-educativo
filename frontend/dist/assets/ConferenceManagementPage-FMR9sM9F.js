import{u as B,r as n,a as D,j as e,L as F,Q as T,D as L,O as M,P as I,K as _,y as $}from"./index-CDtZe3id.js";import{c as f}from"./conferenceService-Bcx88bEU.js";import{C as j}from"./CustomButton-BHk0TsfB.js";import{S as o}from"./sweetalert2.esm.all-CH_YVA8w.js";const G=()=>{const y=B(),[c,C]=n.useState([]),[w,r]=n.useState(!0),[b,x]=n.useState(null),{hasRole:v}=D(),[i,m]=n.useState(1),[l,E]=n.useState(10),p=v(["admin","teacher"]),A=v(["admin"]),h=async()=>{try{r(!0);const s=(await f.getConferences()).sort((a,d)=>a.title.localeCompare(d.title));C(s),x(null)}catch(t){console.error("Error fetching conferences:",t),x("No se pudieron cargar los congresos. Por favor, inténtalo de nuevo más tarde."),$.error("Error al cargar los congresos.")}finally{r(!1)}};n.useEffect(()=>{p?h():(r(!1),x("No tienes permiso para ver esta página."))},[p]);const P=t=>{o.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡eliminar!",cancelButtonText:"Cancelar"}).then(async s=>{if(s.isConfirmed)try{r(!0),await f.deleteConference(t),o.fire("¡Eliminado!","El congreso ha sido eliminado.","success"),h()}catch(a){console.error("Error deleting conference:",a),o.fire("Error",a.response?.data?.message||"Error al eliminar el congreso.","error")}finally{r(!1)}})},k=(t,s)=>{o.fire({title:"¿Estás seguro?",text:`¿Deseas ${s?"desaprobar":"aprobar"} este congreso?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"}).then(async a=>{if(a.isConfirmed)try{r(!0),await f.approveConference(t,!s),o.fire("¡Actualizado!",`El congreso ha sido ${s?"desaprobado":"aprobado"}.`,"success"),h()}catch(d){console.error("Error toggling conference approval:",d),o.fire("Error",d.response?.data?.message||"Error al cambiar el estado de aprobación.","error")}finally{r(!1)}})},g=i*l,N=g-l,S=c.slice(N,g),u=Math.ceil(c.length/l);return w?e.jsxs("div",{className:"mt-28 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(F,{}),e.jsx("p",{className:"mt-4",children:"Cargando congresos..."})]}):b?e.jsxs("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:b})]}):p?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-center w-full mb-4",children:"Gestión de Congresos"}),e.jsx("div",{className:"flex justify-end-safe mb-8",children:e.jsxs(j,{variant:"primary",className:"cursor-pointer",onClick:()=>y("/admin/conferences/create"),children:[e.jsx(T,{className:"inline-block mr-2"})," Crear Nuevo Congreso"]})}),c.length===0?e.jsx("div",{className:"text-center text-text-secondary",children:e.jsx("p",{children:"No hay congresos para gestionar en este momento."})}):e.jsxs("div",{className:"bg-bg-secondary p-6 rounded-lg shadow-md border border-border-color",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"Listado de Congresos"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"mr-2",children:"Items por página:"}),e.jsxs("select",{id:"itemsPerPage",value:l,onChange:t=>{E(Number(t.target.value)),m(1)},className:"bg-bg-secondary border border-border-color rounded-md p-1",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-color",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Título"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Aprobado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-bg-secondary divide-y divide-border-color",children:S.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-primary",children:t.title}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-secondary",children:new Date(t.startDate).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.isApproved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.isApproved?"Sí":"No"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{onClick:()=>y(`/admin/conferences/edit/${t._id}`),className:"text-gray-400 hover:text-accent-primary",title:"Ver/Editar",children:e.jsx(L,{})}),A&&e.jsx("button",{onClick:()=>k(t._id,t.isApproved),className:t.isApproved?"text-yellow-500 hover:text-yellow-700":"text-green-500 hover:text-green-700",title:t.isApproved?"Desaprobar":"Aprobar",children:t.isApproved?e.jsx(M,{}):e.jsx(I,{})}),e.jsx("button",{onClick:()=>P(t._id),className:"text-gray-400 hover:text-red-600",title:"Eliminar",children:e.jsx(_,{})})]})})]},t._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-text-secondary",children:["Mostrando ",N+1," a ",Math.min(g,c.length)," de ",c.length," congresos"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:i===1,variant:"secondary",children:"Anterior"}),e.jsxs("span",{className:"mx-4",children:["Página ",i," de ",u]}),e.jsx(j,{onClick:()=>m(t=>Math.min(t+1,u)),disabled:i===u,variant:"secondary",children:"Siguiente"})]})]})]})]})}):e.jsxs("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para ver esta página."})]})};export{G as default};
