import{b as I,u as $,a as _,r as t,j as e,L as k,y as n}from"./index-CDtZe3id.js";import{c as A}from"./courseService-BSeO5xSq.js";import{l as P}from"./lessonService-DhDsuAxs.js";import{e as j}from"./enrollmentService-C8-aA4rY.js";import{C as v}from"./CustomButton-BHk0TsfB.js";const Y=()=>{const{id:a}=I(),l=$(),{isAuthenticated:c,user:o,hasRole:d}=_(),[r,N]=t.useState(null),[m,y]=t.useState([]),[x,u]=t.useState(!1),[E,p]=t.useState(!0),[h,b]=t.useState(!1),[g,i]=t.useState(null),f=t.useCallback(async()=>{try{p(!0);const s=await A.getCourseById(a),S=o&&s.author&&s.author._id===o.id;if(!s.isPublished&&!S&&!d(["admin"])){i("No tienes permiso para ver este curso (no publicado).");return}if(!s.isGuestViewable&&!c){i("Debes iniciar sesión para ver este curso.");return}if(N(s),c){const D=await j.checkEnrollmentStatus(a);u(D.isEnrolled)}const L=await P.getLessons(a);y(L),i(null)}catch(s){console.error("Error fetching course details:",s),i("No se pudo cargar la información del curso.")}finally{p(!1)}},[a,c,o,d]);t.useEffect(()=>{f()},[f]);const C=async()=>{if(!c||!o){n.error("Debes iniciar sesión para inscribirte."),l("/login");return}b(!0);try{await j.enrollUser({course:a,user:o.id}),n.success("¡Inscripción exitosa!"),u(!0)}catch(s){n.error(s.response?.data?.message||"Error en la inscripción.")}finally{b(!1)}};if(E)return e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(k,{}),e.jsx("p",{className:"mt-4",children:"Cargando detalles del curso..."})]});if(g)return e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:g})]});if(!r)return null;const w=r.cover?`https://portal-educativo-jab.onrender.com/api/covers/${r.cover._id}`:"https://via.placeholder.com/400x200";return e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsx("div",{className:"max-w-[700px] mx-auto",children:e.jsxs("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg border border-border-color",children:[r.cover&&e.jsx("img",{src:w,alt:`Portada de ${r.title}`,className:"w-full h-64 object-cover rounded-md mb-6",onError:s=>{s.target.onerror=null,s.target.src="https://placehold.co/800x400/cccccc/333333?text=No+Image"}}),e.jsx("h1",{className:"text-4xl font-bold text-text-primary mb-4",children:r.title}),e.jsx("p",{className:"text-lg text-text-secondary mb-6",children:r.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Autor:"})," ",r.author?`${r.author.name} ${r.author.last_name}`:"Desconocido"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Materia:"})," ",r.subject?r.subject.name:"Desconocida"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Nivel:"})," ",r.nivel&&typeof r.nivel=="object"?r.nivel.name:r.nivel||"No especificado"]})]}),e.jsx("div",{className:"my-6 p-4 border border-border-color rounded-lg text-center",children:c?x?e.jsx("p",{className:"text-green-500 font-bold text-lg",children:"Ya estás inscrito en este curso."}):e.jsx(v,{variant:"primary",onClick:C,disabled:h,children:h?"Inscribiendo...":"Inscribirse al Curso"}):e.jsx("p",{className:"text-text-secondary",children:"Inicia sesión para inscribirte en este curso."})}),e.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-4",children:"Lecciones"}),m.length===0?e.jsx("p",{className:"text-text-secondary",children:"No hay lecciones disponibles para este curso."}):e.jsx("ul",{className:"space-y-4",children:m.map(s=>e.jsxs("li",{className:"bg-bg-primary p-4 rounded-lg shadow-sm border border-border-color flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:[s.order,". ",s.title]}),e.jsx("p",{className:"text-text-secondary text-sm",children:s.description})]}),x&&e.jsx(v,{variant:"secondary",className:"text-sm",onClick:()=>l(`/lessons/${s._id}`),children:"Ver Lección"})]},s._id))})]})})})};export{Y as default};
