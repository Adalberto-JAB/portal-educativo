import{u as E,r as a,a as A,j as e,L as _,y as D}from"./index-CDtZe3id.js";import{c as P}from"./courseService-BSeO5xSq.js";import{s as $}from"./subjectService-FmAgODbn.js";import{C as v}from"./CustomButton-BHk0TsfB.js";const L=({course:r,onNavigate:o})=>{const u=r.cover?`https://portal-educativo-jab.onrender.com/api/covers/${r.cover._id}`:"https://via.placeholder.com/400x200";return e.jsxs("div",{className:"bg-bg-secondary p-4 rounded-lg shadow-md border border-border-color flex flex-col h-full",children:[e.jsx("img",{src:u,alt:`Portada de ${r.title}`,className:"w-full h-48 sm:h-52 md:h-60 object-cover rounded-md mb-4 bg-bg-tertiary",onError:c=>{c.target.onerror=null,c.target.src="https://placehold.co/400x200/cccccc/333333?text=Error"}}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsx("h2",{className:"text-lg sm:text-xl text-center font-semibold text-text-primary mb-4",children:r.title}),e.jsx("p",{className:"text-text-secondary mb-6 flex-grow",children:r.description}),e.jsxs("div",{className:"flex flex-col text-sm text-text-secondary mb-6 px-4 sm:px-6",children:[e.jsxs("span",{children:["Autor:"," ",r.author?`${r.author.name} ${r.author.last_name}`:"Desconocido"]}),e.jsxs("span",{children:["Materia: ",r.subject?r.subject.name:"Desconocida"]})]}),e.jsx(v,{variant:"primary",className:"w-full mt-auto",onClick:()=>o(r._id),children:"Ver Curso"})]})]})},k=()=>{const r=E(),[o,h]=a.useState([]),[u,c]=a.useState([]),[N,f]=a.useState(!0),[b,y]=a.useState(null),{user:j,isAuthenticated:x,hasRole:p}=A(),[l,C]=a.useState(""),[n,w]=a.useState("");a.useEffect(()=>{(async()=>{try{f(!0);const[s,i]=await Promise.all([P.getCourses(),$.getSubjects()]);h(s);const d=[...i].sort((m,S)=>m.name.localeCompare(S.name));c(d)}catch(s){console.error("Error fetching initial data:",s),y("No se pudieron cargar los datos. Por favor, inténtalo de nuevo más tarde."),D.error("Error al cargar los datos.")}finally{f(!1)}})()},[]);const g=a.useMemo(()=>{let t=o;return!x||j.role==="guest"?t=t.filter(s=>s.isGuestViewable&&s.isPublished):p(["student"])&&(t=t.filter(s=>s.isPublished)),l&&(t=t.filter(s=>s.subject?._id===l)),n&&(t=t.filter(s=>s.title.toLowerCase().includes(n.toLowerCase()))),[...t].sort((s,i)=>{const d=s.subject?.name||"",m=i.subject?.name||"";return d<m?-1:d>m?1:s.title.localeCompare(i.title)})},[o,l,n,x,j,p]);return N?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)]",children:[e.jsx(_,{}),e.jsx("p",{className:"mt-4",children:"Cargando cursos..."})]}):b?e.jsxs("div",{className:"pt-20 p-4 sm:p-6 md:p-8 text-center",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-base sm:text-lg",children:b})]}):e.jsx("div",{className:"mt-28 p-4 sm:p-6 md:p-8 min-h-screen bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-center mb-5",children:"Nuestros Cursos"}),e.jsx("div",{className:"flex justify-end items-center mb-5",children:x&&p(["admin","teacher"])&&e.jsx(v,{variant:"primary",onClick:()=>r("/admin/courses/create"),children:"Crear Curso"})}),e.jsx("p",{className:"text-base sm:text-lg text-center mb-8",children:"Aquí encontrarás nuestros cursos disponibles. ¡Explora y aprende!"}),e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("select",{value:l,onChange:t=>C(t.target.value),className:"px-4 py-2 border rounded-md bg-input-bg text-text-primary border-input-border focus:outline-none focus:ring-2 focus:ring-accent-primary w-full sm:w-auto",children:[e.jsx("option",{value:"",children:"Todas las Materias"}),u.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx("input",{type:"text",placeholder:"Buscar curso por título...",value:n,onChange:t=>w(t.target.value),className:"px-4 py-2 border rounded-md bg-input-bg text-text-primary border-input-border focus:outline-none focus:ring-2 focus:ring-accent-primary w-full sm:w-auto flex-grow"})]}),g.length===0?e.jsx("div",{className:"text-center text-text-secondary py-10",children:e.jsx("p",{children:"No hay cursos que coincidan con tus criterios."})}):e.jsx("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",children:g.map(t=>e.jsx(L,{course:t,onNavigate:s=>r(`/courses/${s}`)},t._id))})]})})};export{k as default};
