import{b as F,u as T,a as U,r as a,j as e,L as R,y as x}from"./index-CDtZe3id.js";import{d as v}from"./documentationService-D56WLKkg.js";import{C as u}from"./CustomButton-BHk0TsfB.js";import{D as V,P as B,G as M}from"./TextLayer-CjKvoo_y.js";M.workerSrc="/pdf.worker.min.mjs";const _=()=>{const{id:l}=F(),c=T(),{user:i,isAuthenticated:N,hasRole:h}=U(),[t,p]=a.useState(null),[o,y]=a.useState(null),[w,g]=a.useState(!0),[f,b]=a.useState(null),[d,D]=a.useState(null),[n,m]=a.useState(1);a.useEffect(()=>{let r=null;return(async()=>{try{g(!0);const s=await v.getById(l),k=i&&s.author&&s.author._id===i.id,A=h(["admin"]);if(!s.isPublished&&!k&&!A){b("Este documento aún no ha sido aprobado por un administrador o no tienes permiso para verlo."),p(null),x.error("Acceso denegado: Documento no aprobado o sin permisos.");return}p(s);const L=await v.getFileContent(l),j=URL.createObjectURL(L);y(j),r=j}catch(s){console.error("Error al obtener detalles o archivo del documento:",s),b("No se pudo cargar el documento. Por favor, inténtalo de nuevo más tarde."),x.error("Error al cargar el documento.")}finally{g(!1)}})(),()=>{r&&URL.revokeObjectURL(r)}},[l,i,N,h]);const P=({numPages:r})=>{D(r),m(1)},C=()=>m(r=>Math.max(r-1,1)),E=()=>m(r=>Math.min(r+1,d));if(w)return e.jsxs("div",{className:"mt-28 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(R,{}),e.jsx("p",{className:"mt-4",children:"Cargando documento..."})]});if(f)return e.jsxs("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:f}),e.jsx("a",{onClick:()=>c("/documentation"),className:"text-accent-primary hover:underline mt-4 block cursor-pointer",children:"Volver a la Documentación"})]});if(!t||!o)return e.jsxs("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Documento No Encontrado"}),e.jsx("p",{className:"text-lg",children:"El documento que buscas no está disponible."}),e.jsx("a",{onClick:()=>c("/documentation"),className:"text-accent-primary hover:underline mt-4 block cursor-pointer",children:"Volver a la Documentación"})]});const S=()=>{switch(t.fileType){case"Imagen":return e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx("img",{src:o,alt:t.title,className:"max-w-full h-auto rounded-lg shadow-md"})});case"Video":return e.jsxs("div",{className:"flex justify-center items-center p-4 max-h-screen overflow-hidden",children:[" ",e.jsxs("video",{controls:!0,className:"w-full max-h-[calc(100vh-200px)] rounded-lg shadow-md aspect-video",children:[" ",e.jsx("source",{src:o,type:t.contentType||"video/mp4"}),"Tu navegador no soporta la etiqueta de video."]})]});case"PDF":return e.jsxs("div",{className:"flex flex-col items-center p-4 w-full",children:[e.jsxs("div",{className:"pdf-viewer-controls flex flex-wrap justify-center gap-4 mb-4",children:[e.jsx(u,{onClick:C,disabled:n<=1,children:"Página Anterior"}),e.jsxs("span",{className:"text-text-primary text-lg font-semibold self-center",children:["Página ",n," de ",d||"..."]}),e.jsx(u,{onClick:E,disabled:n>=d,children:"Página Siguiente"})]}),e.jsx("div",{className:"pdf-container w-full max-w-3xl border border-border-color rounded-lg overflow-hidden shadow-lg",children:e.jsx(V,{file:o,onLoadSuccess:P,onLoadError:r=>{console.error("Error al cargar el PDF:",r),x.error("Error al cargar el PDF.")},className:"w-full",children:e.jsx(B,{pageNumber:n,width:Math.min(800,window.innerWidth*.8)})})})]});default:return e.jsx("p",{className:"text-red-500 text-lg",children:"Tipo de archivo no soportado para visualización."})}};return e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg border border-border-color max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold text-text-primary mb-4",children:t.title}),e.jsx("p",{className:"text-lg text-text-secondary mb-6",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("p",{className:"text-text-primary",children:[e.jsx("span",{className:"font-semibold",children:"Autor:"})," ",t.author?`${t.author.name} ${t.author.last_name}`:"Desconocido"]}),e.jsxs("p",{className:"text-text-primary md:text-end md:pr-5",children:[e.jsx("span",{className:"font-semibold",children:"Tipo de Archivo:"})," ",t.fileType]}),e.jsxs("p",{className:"text-text-primary",children:[e.jsx("span",{className:"font-semibold",children:"Aprobado:"})," ",t.isPublished?"Sí":"No"]})]}),e.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-4 text-center",children:"Contenido del Documento"}),S(),e.jsx("div",{className:"mt-8 text-center",children:e.jsx(u,{variant:"secondary",onClick:()=>c("/documentation"),children:"Volver a la Documentación"})})]})})};export{_ as default};
