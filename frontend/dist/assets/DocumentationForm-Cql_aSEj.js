import{r as o,j as e,L as V}from"./index-CDtZe3id.js";import{u as B}from"./index.esm-CYe7NKTW.js";import{C as P}from"./CustomButton-BHk0TsfB.js";import{s as I}from"./subjectService-FmAgODbn.js";import{a as J}from"./asignaturaService-DmxOcZI9.js";import{n as R}from"./nivelService-D0XCMSzS.js";import{c as W}from"./coverService-mfvIq_ty.js";const y=[{value:"Imagen",label:"Imagen",mime:["image/jpeg","image/png","image/webp"]},{value:"PDF",label:"PDF",mime:["application/pdf"]},{value:"Video",label:"Video",mime:["video/mp4","video/webm","video/ogg"]}],X=({onSubmit:q,initialData:n={},isEditing:x=!1})=>{const{register:c,handleSubmit:T,watch:L,formState:{errors:a},setError:g,clearErrors:p}=B({defaultValues:n}),[N,F]=o.useState(!1),[j,_]=o.useState({subjects:[],asignaturas:[],niveles:[],covers:[]}),[w,u]=o.useState(""),[C,v]=o.useState(null),[S,b]=o.useState(""),[E,h]=o.useState(""),[A,f]=o.useState(""),D=L("fileType");o.useEffect(()=>{(async()=>{F(!0);try{const[s,l,i,d]=await Promise.all([I.getSubjects(),J.getAllAsignaturas(),R.getNiveles(),W.getCovers()]);_({subjects:Array.isArray(s)?s.sort((t,m)=>t.name.localeCompare(m.name)):[],asignaturas:Array.isArray(l)?l.sort((t,m)=>t.name.localeCompare(m.name)):[],niveles:Array.isArray(i)?i.sort((t,m)=>t.name.localeCompare(m.name)):[],covers:Array.isArray(d)?d.sort((t,m)=>t.name.localeCompare(m.name)):[]})}catch(s){console.error("Error loading select data",s)}finally{F(!1)}})()},[]),o.useEffect(()=>{x&&n&&(n.cover&&(v(`https://portal-educativo-jab.onrender.com/api/covers/${n.cover._id}`),h(n.cover.name)),n.originalContentFileName&&f(n.originalContentFileName))},[n,x]);const G=r=>{const s=r.target.files[0];if(s)if(!["image/jpeg","image/png","image/webp"].includes(s.type))u("Solo se permiten imágenes JPG, PNG o WEBP para la portada."),v(null),h(""),g("coverFile",{type:"manual",message:"Formato de imagen inválido."});else{u(""),h(s.name),p("coverFile");const l=new FileReader;l.onloadend=()=>{v(l.result)},l.readAsDataURL(s)}else v(null),h(""),u(""),p("coverFile")},$=r=>{const s=r.target.files[0],l=y.find(i=>i.value===D);s?(f(s.name),l&&!l.mime.includes(s.type)?(b(`El archivo debe ser de tipo ${l.label}.`),g("contentFile",{type:"manual",message:`Formato de archivo inválido para ${l.label}.`})):(b(""),p("contentFile"))):(f(""),b(""),p("contentFile"))},k=r=>{const s=r.coverFile?.[0];if(s&&!["image/jpeg","image/png","image/webp"].includes(s.type)){u("Solo se permiten imágenes JPG, PNG o WEBP para la portada."),g("coverFile",{type:"manual",message:"Formato de imagen inválido."});return}const l=r.contentFile?.[0],i=y.find(t=>t.value===r.fileType);if(l&&i&&!i.mime.includes(l.type)){b(`El archivo debe ser de tipo ${i.label}.`),g("contentFile",{type:"manual",message:`Formato de archivo inválido para ${i.label}.`});return}u(""),b(""),p("coverFile"),p("contentFile");const d=new FormData;Object.keys(r).forEach(t=>{t==="contentFile"&&r[t]?.[0]?d.append("content",r[t][0]):t==="coverFile"&&r[t]?.[0]?d.append("coverImage",r[t][0]):d.append(t,r[t])}),q(d)};return N?e.jsx(V,{}):e.jsxs("form",{onSubmit:T(k),className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto border border-border-color",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[x?"Editar":"Crear"," Documento"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Título"}),e.jsx("input",{...c("title",{required:"El título es requerido"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),a.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.title.message})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Descripción"}),e.jsx("textarea",{...c("description",{required:"La descripción es requerida"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",rows:"4"}),a.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Materia"}),e.jsxs("select",{...c("subject",{required:"La materia es requerida"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:[e.jsx("option",{value:"",children:"Seleccionar Materia"}),j.subjects.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),a.subject&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.subject.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Asignatura"}),e.jsxs("select",{...c("asignatura",{required:"La asignatura es requerida"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:[e.jsx("option",{value:"",children:"Seleccionar Asignatura"}),j.asignaturas.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),a.asignatura&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.asignatura.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Nivel"}),e.jsxs("select",{...c("nivel",{required:"El nivel es requerido"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:[e.jsx("option",{value:"",children:"Seleccionar Nivel"}),j.niveles.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),a.nivel&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.nivel.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Tipo de Archivo"}),e.jsxs("select",{...c("fileType",{required:"El tipo de archivo es requerido"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:[e.jsx("option",{value:"",children:"Seleccionar Tipo"}),y.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),a.fileType&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.fileType.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Portada (Imagen JPG, PNG o WEBP)"}),e.jsx("input",{type:"file",accept:".jpg,.jpeg,.png,.webp,image/jpeg,image/png,image/webp",...c("coverFile"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",onChange:G}),E&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Archivo: ",E]}),w&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:w}),C&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"block text-xs text-text-secondary mb-1",children:"Vista previa:"}),e.jsx("img",{src:C,alt:"Vista previa portada",className:"max-h-40 rounded shadow"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",children:"Archivo de Contenido"}),e.jsx("input",{type:"file",...c("contentFile",{required:x?!1:"El archivo de contenido es requerido"}),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",onChange:$}),A&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Archivo: ",A]}),S&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:S}),a.contentFile&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.contentFile.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx(P,{type:"button",variant:"secondary",className:"cursor-pointer",onClick:()=>window.history.back(),children:"Cancelar"}),e.jsx(P,{type:"submit",variant:"primary",className:"cursor-pointer",disabled:N,children:x?"Actualizar":"Crear"})]})]})};export{X as D};
