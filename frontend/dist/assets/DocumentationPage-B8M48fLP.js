import{u as E,r as a,a as _,j as t,L as P,y as $}from"./index-CDtZe3id.js";import{d as I}from"./documentationService-D56WLKkg.js";import{s as L}from"./subjectService-FmAgODbn.js";import{C as y}from"./CustomButton-BHk0TsfB.js";const R=()=>{const m=E(),[u,v]=a.useState([]),[x,N]=a.useState([]),[S,p]=a.useState(!0),[h,f]=a.useState(null),{user:b,isAuthenticated:g,hasRole:r}=_(),[o,w]=a.useState(""),[i,D]=a.useState(""),[l,A]=a.useState(""),C=[{value:"Imagen",label:"Imagen"},{value:"Video",label:"Video"},{value:"PDF",label:"PDF"}],T="https://portal-educativo-jab.onrender.com";a.useEffect(()=>{(async()=>{try{p(!0);const s=await I.getAll(),n=await L.getSubjects();v(Array.isArray(s)?s:[]);const c=Array.isArray(n)?[...n].sort((d,B)=>d.name.localeCompare(B.name)):[];N(c),f(null)}catch(s){f("No se pudieron cargar los datos iniciales (documentos o materias). Por favor, inténtalo de nuevo más tarde."),$.error("Error al cargar los datos."),console.log("Error fetching initial data:",s)}finally{p(!1)}})()},[]);const j=a.useMemo(()=>{let e=u;return r(["admin"])||(r(["teacher","student"])?e=e.filter(s=>s.uploadedBy&&s.uploadedBy._id===b.id||s.isPublished):e=e.filter(s=>s.isPublished)),o&&(e=e.filter(s=>s.subject&&s.subject._id===o)),i&&(e=e.filter(s=>s.fileType===i)),l&&(e=e.filter(s=>s.title.toLowerCase().includes(l.toLowerCase()))),[...e].sort((s,n)=>{const c=s.title||"",d=n.title||"";return c.localeCompare(d)})},[u,o,i,l,b,r]);return S?t.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[t.jsx(P,{}),t.jsx("p",{className:"mt-4",children:"Cargando documentación..."})]}):h?t.jsxs("div",{className:"mt-20 md:mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[t.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),t.jsx("p",{className:"text-lg",children:h})]}):t.jsx("div",{className:"mt-20 md:mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:t.jsxs("div",{className:"max-w-[1024px] m-auto",children:[t.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Documentación"}),t.jsx("div",{className:"flex justify-end-safe items-center mb-8",children:g&&r(["admin","teacher","student"])&&t.jsx(y,{variant:"primary",onClick:()=>m("/documentation/create"),children:"Subir Nuevo Documento"})}),t.jsx("p",{className:"text-lg mb-8",children:"Explora nuestra biblioteca de documentos, guías y recursos."}),t.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row gap-4 items-center",children:[t.jsxs("select",{value:o,onChange:e=>w(e.target.value),className:"px-4 py-2 border rounded-md bg-input-bg text-text-primary border-input-border focus:outline-none focus:ring-2 focus:ring-accent-primary w-full sm:w-auto",children:[t.jsx("option",{value:"",children:"Todas las Materias"}),Array.isArray(x)&&x.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]}),t.jsxs("select",{value:i,onChange:e=>D(e.target.value),className:"px-4 py-2 border rounded-md bg-input-bg text-text-primary border-input-border focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[t.jsx("option",{value:"",children:"Todos los Tipos"}),C.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]}),t.jsx("input",{type:"text",placeholder:"Buscar documento por título...",value:l,onChange:e=>A(e.target.value),className:"px-4 py-2 border rounded-md bg-input-bg text-text-primary border-input-border focus:outline-none focus:ring-2 focus:ring-accent-primary w-full sm:w-auto flex-grow"})]}),j.length===0?t.jsxs("div",{className:"text-center text-text-secondary",children:[t.jsx("p",{children:"No hay documentos disponibles que coincidan con tus criterios."}),!g&&t.jsx("p",{className:"mt-2",children:"Inicia sesión o regístrate para ver más documentos."})]}):t.jsx("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(e=>t.jsxs("div",{className:"bg-bg-secondary p-6 rounded-lg shadow-md border border-border-color flex flex-col",children:[t.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:e.title}),e.cover&&t.jsx("div",{className:"mb-4 flex justify-center",children:t.jsx("img",{src:`${T}/api/covers/${e.cover?._id}`,alt:`Portada de ${e.title}`,className:"max-h-40 w-auto rounded-lg shadow-md object-contain"})}),t.jsx("p",{className:"text-text-secondary mb-4 flex-grow",children:e.description}),t.jsxs("div",{className:"flex justify-between items-center text-sm text-text-secondary mb-4",children:[t.jsxs("span",{children:["Autor: ",e.uploadedBy?`${e.uploadedBy.name} ${e.uploadedBy.last_name}`:"Desconocido"]}),t.jsxs("span",{children:["Tipo: ",e.fileType||"N/A"]})]}),t.jsx(y,{variant:"primary",className:"w-full mt-auto",onClick:()=>m(`/documentation/${e._id}`),children:"Ver Documento"})]},e._id))})]})})};export{R as default};
