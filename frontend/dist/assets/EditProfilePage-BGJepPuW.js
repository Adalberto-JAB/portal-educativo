import{a as D,u as I,r as n,j as e,L as x,y as g}from"./index-CDtZe3id.js";import{u as P}from"./userService-BeE_nVnS.js";import{C as j}from"./CustomButton-BHk0TsfB.js";import{u as z}from"./index.esm-CYe7NKTW.js";import{o as $,c as V,a as d}from"./index.esm-DVNFl3iM.js";import{g as B,a as G}from"./avatarApiUtil-DtOOGbiP.js";const R=r=>{let a=r.length,m;for(;a!==0;)m=Math.floor(Math.random()*a),a--,[r[a],r[m]]=[r[m],r[a]];return r},M=V().shape({name:d().required("El nombre es requerido"),last_name:d().required("El apellido es requerido"),email:d().email("Formato de email inválido").required("El email es requerido"),address:d().nullable(),phoneNumber:d().nullable(),profilePictureURL:d().required("Debes seleccionar un avatar")}),W=()=>{const{user:r,loading:a,updateAuthUser:m}=D(),u=I(),[v,y]=n.useState(!1),[S,N]=n.useState(!0),[p,b]=n.useState(!0),[f,E]=n.useState(""),[k,A]=n.useState([]),[h,w]=n.useState(""),{register:c,handleSubmit:C,formState:{errors:l},setValue:i,trigger:U}=z({resolver:$(M),defaultValues:{name:"",last_name:"",email:"",address:"",phoneNumber:"",profilePictureURL:""}});n.useEffect(()=>{a||(async()=>{if(!r?.id){N(!1);return}try{const{defaultAvatar:s,randomAvatars:F}=B();E(s),A(R(F)),b(!1);const o=await P.getUserById(r.id);i("name",o.name||""),i("last_name",o.last_name||""),i("email",o.email||""),i("address",o.address||""),i("phoneNumber",o.phoneNumber||""),i("profilePictureURL",o.profilePictureURL||s),w(o.profilePictureURL||s)}catch(s){console.error("Error fetching data:",s),g.error("No se pudo cargar la información del perfil."),u("/profile")}finally{N(!1)}})()},[r,a,i,u]);const L=t=>{w(t),i("profilePictureURL",t,{shouldValidate:!0}),U("profilePictureURL")},_=()=>{b(!0);const t=G();A(R(t)),b(!1)},q=async t=>{try{y(!0);const s=await P.updateUser(r.id,t);m(s),g.success("Perfil actualizado exitosamente."),u("/profile")}catch(s){console.error("Error updating profile:",s),g.error("Error al actualizar el perfil.")}finally{y(!1)}};return S||a?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(x,{}),e.jsx("p",{className:"mt-4",children:"Cargando editor de perfil..."})]}):e.jsx("div",{className:"mt-20 md:mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 md:mb-9 text-center",children:"Editar Perfil"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:C(q),className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2 md:mb-4",children:"Elige tu Avatar:"}),e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("p",{className:"text-sm text-text-secondary mb-2 md:mb-4",children:"Avatar Actual"}),e.jsx("img",{src:h,alt:"Avatar seleccionado",className:"w-24 h-24 rounded-full cursor-pointer p-1 bg-gray-700 ring-2 ring-accent-primary"})]}),e.jsx("div",{className:"flex justify-center mb-4 md:my-6",children:e.jsx(j,{variant:"secondary",type:"button",onClick:_,disabled:p,children:p?e.jsx(x,{size:"sm"}):"Generar nuevos avatares"})}),p?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx(x,{})}):e.jsxs("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-4",children:[e.jsx("img",{src:f,alt:"Avatar por defecto",className:`w-full h-auto rounded-full cursor-pointer p-1 bg-gray-700 ${h===f?"ring-2 ring-accent-primary":""}`,onClick:()=>L(f)}),k.map(t=>e.jsx("img",{src:t,alt:"Avatar aleatorio",className:`w-full h-auto rounded-full cursor-pointer p-1 bg-gray-700 ${h===t?"ring-2 ring-accent-primary":""}`,onClick:()=>L(t)},t))]}),l.profilePictureURL&&e.jsx("p",{className:"text-red-500 text-xs mt-2 text-center",children:l.profilePictureURL.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"name",children:"Nombre:"}),e.jsx("input",{type:"text",id:"name",...c("name"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),l.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"last_name",children:"Apellido:"}),e.jsx("input",{type:"text",id:"last_name",...c("last_name"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),l.last_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.last_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",...c("email"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),l.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"address",children:"Dirección:"}),e.jsx("input",{type:"text",id:"address",...c("address"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"phoneNumber",children:"Teléfono:"}),e.jsx("input",{type:"text",id:"phoneNumber",...c("phoneNumber"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(j,{variant:"secondary",type:"button",className:"cursor-pointer",onClick:()=>u("/profile"),children:"Cancelar"}),e.jsx(j,{variant:"primary",type:"submit",className:"cursor-pointer",disabled:v,children:v?e.jsx(x,{size:"sm"}):"Guardar Cambios"})]})]})})]})})};export{W as default};
