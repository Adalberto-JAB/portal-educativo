import{u as N,r as i,a as w,j as e,L as E,J as A,O as C,P as F,K as B,y as P}from"./index-CDtZe3id.js";import{f as m}from"./forumService-DfOgb0S1.js";import{S as o}from"./sweetalert2.esm.all-CH_YVA8w.js";const D=()=>{const g=N(),[p,y]=i.useState([]),[b,a]=i.useState(!0),[h,l]=i.useState(null),{hasRole:n,user:u}=w(),c=n(["admin","teacher"]),d=n(["admin"]),x=async()=>{try{a(!0);const t=await m.getForumPosts();let r=t;n(["teacher"])&&!d&&(r=t.filter(s=>s.author&&s.author._id===u.id||!s.isApproved)),y(r),l(null)}catch(t){console.error("Error fetching forum posts:",t),l("No se pudieron cargar los posts del foro. Por favor, inténtalo de nuevo más tarde."),P.error("Error al cargar los posts del foro.")}finally{a(!1)}};i.useEffect(()=>{c?x():(a(!1),l("No tienes permiso para ver esta página."))},[c,d,u]);const j=t=>{o.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡eliminar!",cancelButtonText:"Cancelar"}).then(async r=>{if(r.isConfirmed)try{a(!0),await m.deleteForumPost(t),o.fire("¡Eliminado!","El post del foro ha sido eliminado.","success"),x()}catch(s){console.error("Error deleting forum post:",s),o.fire("Error",s.response?.data?.message||"Error al eliminar el post del foro.","error")}finally{a(!1)}})},v=(t,r)=>{o.fire({title:"¿Estás seguro?",text:`¿Deseas ${r?"desaprobar":"aprobar"} este post?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, continuar",cancelButtonText:"Cancelar"}).then(async s=>{if(s.isConfirmed)try{a(!0),await m.approveForumPost(t,!r),o.fire("¡Actualizado!",`El post ha sido ${r?"desaprobado":"aprobado"}.`,"success"),x()}catch(f){console.error("Error toggling forum post approval:",f),o.fire("Error",f.response?.data?.message||"Error al cambiar el estado de aprobación.","error")}finally{a(!1)}})};return b?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(E,{}),e.jsx("p",{className:"mt-4",children:"Cargando posts del foro..."})]}):h?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:h})]}):c?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-center w-full mb-8",children:"Gestión de Foros"}),p.length===0?e.jsx("div",{className:"text-center text-text-secondary",children:e.jsx("p",{children:"No hay posts de foro para gestionar en este momento."})}):e.jsxs("div",{className:"bg-bg-secondary p-6 rounded-lg shadow-md border border-border-color",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-4",children:"Listado de Posts del Foro"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-color",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Título"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Autor"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Aprobado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-bg-secondary divide-y divide-border-color",children:p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-primary",children:t.title}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-secondary",children:t.author?`${t.author.name} ${t.author.last_name}`:"Desconocido"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.isApproved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.isApproved?"Sí":"No"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx("button",{onClick:()=>g(`/admin/forums-management/edit/${t._id}`),className:"text-gray-400 hover:text-accent-primary",title:"Editar",children:e.jsx(A,{})}),d&&e.jsx("button",{onClick:()=>v(t._id,t.isApproved),className:t.isApproved?"text-yellow-500 hover:text-yellow-700":"text-green-500 hover:text-green-700",title:t.isApproved?"Desaprobar":"Aprobar",children:t.isApproved?e.jsx(C,{}):e.jsx(F,{})}),e.jsx("button",{onClick:()=>j(t._id),className:"text-gray-400 hover:text-red-600",title:"Eliminar",children:e.jsx(B,{})})]})})]},t._id))})]})})]})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para ver esta página."})]})};export{D as default};
