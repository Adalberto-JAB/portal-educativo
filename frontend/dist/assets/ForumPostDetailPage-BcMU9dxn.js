import{b as v,r as c,j as e,L as j,o as y,q as g,c as N,s as C,a as f,t as S,v as w,y as i}from"./index-CDtZe3id.js";import{u as E}from"./index.esm-CYe7NKTW.js";import{o as A,c as P,a as F}from"./index.esm-DVNFl3iM.js";import{f as D}from"./forumService-DfOgb0S1.js";import{c as u}from"./commentService-pSMtB1uE.js";import{C as b}from"./CustomButton-BHk0TsfB.js";const L=({comment:s,onAction:t})=>{const{hasRole:l}=f(),a=l(["admin","teacher"]),m=s.author?.profilePictureURL||"https://api.dicebear.com/8.x/adventurer/svg?seed=default-seed&sex=male",p=async()=>{try{await u.approveComment(s._id,!0),i.success("Comentario aprobado."),t()}catch{i.error("Error al aprobar el comentario.")}},d=async()=>{try{await u.approveComment(s._id,!1),i.warn("Comentario rechazado."),t()}catch{i.error("Error al rechazar el comentario.")}};return e.jsxs("div",{className:`flex items-start space-x-4 py-4 ${s.isApproved?"":"bg-yellow-900/20"}`,children:[e.jsx("img",{src:m,alt:"Avatar del autor",className:"w-12 h-12 rounded-full bg-bg-tertiary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-bold text-text-primary",children:s.author?`${s.author.name} ${s.author.last_name}`:"Anónimo"}),e.jsx("span",{className:"text-xs text-text-secondary",children:new Date(s.createdAt).toLocaleString("es-ES")}),!s.isApproved&&e.jsx("span",{className:"text-xs font-semibold text-yellow-400 ml-2",children:"(Pendiente de Aprobación)"})]}),a&&e.jsxs("div",{className:"flex items-center space-x-2",children:[s.isApproved?null:e.jsx(b,{onClick:p,size:"sm",className:"!py-1 !px-2 bg-green-600 hover:bg-green-700",children:e.jsx(S,{})}),e.jsx(b,{onClick:d,size:"sm",className:"!py-1 !px-2 bg-red-600 hover:bg-red-700",children:e.jsx(w,{})})]})]}),e.jsx("p",{className:"text-text-secondary mt-1",children:s.text})]})]})},_=P().shape({text:F().required("El comentario no puede estar vacío.").min(3,"El comentario debe tener al menos 3 caracteres.")}),$=({postId:s,onCommentPosted:t})=>{const{user:l}=f(),[a,m]=c.useState(!1),{register:p,handleSubmit:d,formState:{errors:o},reset:h}=E({resolver:A(_)}),x=async r=>{if(!l){i.error("Debes iniciar sesión para comentar.");return}m(!0);try{const n={...r,author:l.id,forumPost:s};await u.createComment(n),i.success("Comentario enviado. Estará visible una vez aprobado."),h(),t()}catch(n){i.error(n.response?.data?.message||"Error al enviar el comentario.")}finally{m(!1)}};return e.jsxs("form",{onSubmit:d(x),className:"mt-6",children:[e.jsx("textarea",{...p("text"),rows:"4",className:"w-full p-3 border rounded-md bg-input-bg text-text-primary border-input-border",placeholder:"Escribe tu comentario..."}),o.text&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.text.message}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(b,{type:"submit",disabled:a,children:a?e.jsx(j,{size:"sm"}):"Enviar Comentario"})})]})},T=()=>{const{id:s}=v(),[t,l]=c.useState(null),[a,m]=c.useState([]),[p,d]=c.useState(!0),[o,h]=c.useState(null),x=c.useCallback(async()=>{try{const r=await u.getComments(s);m(r)}catch(r){console.error("Error fetching comments:",r)}},[s]);return c.useEffect(()=>{(async()=>{try{d(!0);const n=await D.getForumPostById(s);l(n),await x()}catch(n){h("No se pudo cargar el post. Es posible que no esté aprobado o no exista."),console.error("Error fetching post:",n)}finally{d(!1)}})()},[s,x]),p?e.jsx("div",{className:"pt-20 flex justify-center items-center min-h-screen",children:e.jsx(j,{})}):o?e.jsx("div",{className:"pt-20 text-center text-red-500",children:e.jsx("p",{children:o})}):t?e.jsx("div",{className:"mt-28 p-4 md:p-8 min-h-screen bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-bg-secondary p-6 md:p-8 rounded-lg shadow-lg border border-border-color",children:[e.jsxs("div",{className:"border-b border-border-color pb-4 mb-6",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-text-primary mb-4",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center text-sm text-text-secondary gap-x-4 gap-y-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(y,{className:"mr-2"})," ",t.author?`${t.author.name} ${t.author.last_name}`:"Anónimo"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(g,{className:"mr-2"})," ",new Date(t.createdAt).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]}),t.subject&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(N,{className:"mr-2"})," ",e.jsx(C,{to:`/forums/subject/${t.subject._id}`,className:"hover:underline",children:t.subject.name})]})]})]}),e.jsx("div",{className:"prose prose-invert max-w-none text-text-primary text-lg",dangerouslySetInnerHTML:{__html:t.content.replace(/\n/g,"<br />")}}),e.jsxs("div",{className:"mt-8 border-t border-border-color pt-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Comentarios (",a.length,")"]}),e.jsx($,{postId:s,onCommentPosted:x}),e.jsx("div",{className:"mt-6 space-y-2 divide-y divide-border-color",children:a.length>0?a.map(r=>e.jsx(L,{comment:r,onAction:x},r._id)):e.jsx("p",{className:"text-text-secondary py-4",children:"No hay comentarios todavía. ¡Sé el primero en comentar!"})})]})]})}):e.jsx("div",{className:"pt-20 text-center text-text-secondary",children:"Post no encontrado."})};export{T as default};
