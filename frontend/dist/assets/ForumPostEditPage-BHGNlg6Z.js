import{b as P,u as C,a as k,r as x,j as e,L as j,y as a}from"./index-CDtZe3id.js";import{f as y}from"./forumService-DfOgb0S1.js";import{u as q}from"./userService-BeE_nVnS.js";import{C as v}from"./CustomButton-BHk0TsfB.js";import{u as _}from"./index.esm-CYe7NKTW.js";import{o as D,c as L,f as U,a as f}from"./index.esm-DVNFl3iM.js";const $=L().shape({title:f().required("El título es requerido"),content:f().required("El contenido es requerido"),author:f().required("El autor es requerido"),isApproved:U()}),H=()=>{const{id:u}=P(),l=C(),{user:b,hasRole:d}=k(),[n,o]=x.useState(!0),[N,A]=x.useState([]),[g,w]=x.useState(null),{register:c,handleSubmit:E,formState:{errors:s},setValue:i}=_({resolver:D($)}),m=d(["admin","teacher"]),p=d(["admin"]);x.useEffect(()=>{(async()=>{if(!m){o(!1),a.error("No tienes permiso para editar posts del foro.");return}try{o(!0);const t=await y.getForumPostById(u);if(d(["teacher"])&&!p&&t.author._id!==b.id){a.error("No tienes permiso para editar este post del foro."),l("/admin/forums-management");return}i("title",t.title||""),i("content",t.content||""),i("author",t.author?._id||""),i("isApproved",t.isApproved||!1);const F=(await q.getUsers()).filter(h=>h.role==="teacher"||h.role==="admin"||h.role==="student");A(F)}catch(t){console.error("Error fetching data for forum post edit:",t),a.error("Error al cargar datos del post para edición."),w(t.response?.data?.message||"No se pudo cargar el post para edición.")}finally{o(!1)}})()},[u,m,p,b,l,d,i]);const S=async r=>{if(!m){a.error("No tienes permiso para modificar posts del foro.");return}o(!0);try{const t={...r,isApproved:p?r.isApproved:!1};await y.updateForumPost(u,t),a.success("Post del foro actualizado exitosamente."),l("/admin/forums-management")}catch(t){console.error("Error updating forum post:",t),a.error(t.response?.data?.message||"Error al actualizar el post.")}finally{o(!1)}};return n?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(j,{}),e.jsx("p",{className:"mt-4",children:"Cargando post del foro para edición..."})]}):g?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:g})]}):m?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center w-full",children:"Editar Post del Foro"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:E(S),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"title",children:"Título:"}),e.jsx("input",{type:"text",id:"title",...c("title"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),s.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"content",children:"Contenido:"}),e.jsx("textarea",{id:"content",...c("content"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",rows:"8"}),s.content&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.content.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"author",children:"Autor:"}),e.jsxs("select",{id:"author",...c("author"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",disabled:!0,children:[e.jsx("option",{value:"",children:"Selecciona un autor"}),N.map(r=>e.jsxs("option",{value:r._id,children:[r.name," ",r.last_name]},r._id))]}),s.author&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.author.message})]}),p&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isApproved",...c("isApproved"),className:"form-checkbox h-5 w-5 text-accent-primary rounded"}),e.jsx("label",{className:"text-text-primary text-sm",htmlFor:"isApproved",children:"Aprobado por Admin"})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(v,{variant:"secondary",onClick:()=>l("/admin/forums-management"),disabled:n,children:"Cancelar"}),e.jsx(v,{variant:"primary",type:"submit",disabled:n,children:n?e.jsx(j,{}):"Guardar Cambios"})]})]})})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para editar posts del foro."})]})};export{H as default};
