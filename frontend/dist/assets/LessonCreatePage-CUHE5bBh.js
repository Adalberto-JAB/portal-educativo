import{b as v,u as F,a as E,r as p,y as i,j as e,L as b}from"./index-CDtZe3id.js";import{u as w}from"./index.esm-CYe7NKTW.js";import{o as S,c as C,d as L,e as q,a as f}from"./index.esm-DVNFl3iM.js";import{l as D}from"./lessonService-DhDsuAxs.js";import{C as h}from"./CustomButton-BHk0TsfB.js";const P=C().shape({title:f().required("El título es requerido."),description:f().required("La descripción es requerida."),order:q().typeError("El orden debe ser un número.").required("El orden es requerido.").positive("El orden debe ser un número positivo.").integer("El orden debe ser un número entero."),pdfFile:L().required("El archivo PDF es requerido.").test("fileType","Solo se permiten archivos PDF.",r=>r&&r[0]&&r[0].type==="application/pdf").test("fileSize","El archivo es demasiado grande (máx. 5MB). ",r=>r&&r[0]&&r[0].size<=5*1024*1024)}),I=()=>{const{courseId:r}=v(),a=F(),{user:n,isAuthenticated:m,hasRole:g}=E(),[o,x]=p.useState(!1),[u,y]=p.useState(null),{register:l,handleSubmit:j,formState:{errors:s}}=w({resolver:S(P)}),c=g(["admin","teacher"]);p.useEffect(()=>{(!m||!c)&&(i.error("No tienes permiso para crear lecciones."),a("/admin/courses"))},[m,c,a]);const N=async d=>{if(!c){i.error("No tienes permiso para crear lecciones.");return}if(!n||!n.id){i.error("ID de usuario no disponible. Por favor, intenta recargar la página o iniciar sesión de nuevo.");return}x(!0);try{const t=new FormData;t.append("title",d.title),t.append("description",d.description),t.append("order",d.order),t.append("course",r),t.append("uploadedBy",n.id),t.append("pdfFile",d.pdfFile[0]),await D.createLesson(t),i.success("Lección creada exitosamente."),a(`/admin/courses/edit/${r}`)}catch(t){console.error("Error creating lesson:",t),y(t.response?.data?.message||"Error al crear la lección."),i.error(t.response?.data?.message||"Error al crear la lección.")}finally{x(!1)}};return u?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:u})]}):o?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(b,{}),e.jsx("p",{className:"mt-4",children:"Creando lección..."})]}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Crear Nueva Lección para el Curso"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:j(N),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"title",children:"Título:"}),e.jsx("input",{type:"text",id:"title",...l("title"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),s.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"description",children:"Descripción:"}),e.jsx("textarea",{id:"description",...l("description"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",rows:"4"}),s.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"order",children:"Orden:"}),e.jsx("input",{type:"number",id:"order",...l("order"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),s.order&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.order.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"pdfFile",children:"Archivo PDF:"}),e.jsx("input",{type:"file",id:"pdfFile",...l("pdfFile"),accept:".pdf",className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent-primary file:text-white hover:file:bg-blue-700"}),s.pdfFile&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.pdfFile.message})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(h,{variant:"secondary",onClick:()=>a(`/admin/courses/${r}/edit`),disabled:o,children:"Cancelar"}),e.jsx(h,{variant:"primary",type:"submit",disabled:o,children:o?e.jsx(b,{}):"Crear Lección"})]})]})})]})};export{I as default};
