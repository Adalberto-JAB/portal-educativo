import{b as A,u as B,a as F,r,y as m,j as e,L as b}from"./index-CDtZe3id.js";import{l as j}from"./lessonService-DhDsuAxs.js";import{c as M}from"./courseService-BSeO5xSq.js";import{C as N}from"./CustomButton-BHk0TsfB.js";import{D as G,P as I,G as R}from"./TextLayer-CjKvoo_y.js";R.workerSrc="/pdf.worker.min.mjs";const V=()=>{const{id:i}=A();B();const{user:c,isAuthenticated:x,hasRole:u}=F(),[l,v]=r.useState(null),[p,y]=r.useState(null),[P,h]=r.useState(!0),[g,a]=r.useState(null),[o,L]=r.useState(null),[n,d]=r.useState(1),w=({numPages:s})=>{L(s),d(1)},S=()=>d(s=>Math.max(s-1,1)),C=()=>d(s=>Math.min(s+1,o)),f=r.useCallback(async()=>{try{h(!0);const s=await j.getLessonById(i);if(!s){a("Lección no encontrada.");return}const t=await M.getCourseById(s.course._id);if(!t){a("Curso asociado a la lección no encontrado.");return}const D=c&&t.author&&t.author._id===c.id,E=u(["admin"]);if(x){if(!t.isPublished&&!D&&!E){a("No tienes permiso para ver esta lección (curso no publicado)."),m.error("No tienes permiso para ver esta lección.");return}}else if(!t.isGuestViewable){a("Debes iniciar sesión para ver esta lección."),m.error("Debes iniciar sesión para ver esta lección.");return}v(s);const k=await j.getLessonPdf(i);y(k),a(null)}catch(s){console.error("Error fetching lesson details:",s);const t=s.response?.data?.message||"No se pudo cargar la lección.";a(t),m.error(t)}finally{h(!1)}},[i,c,x,u]);return r.useEffect(()=>{f()},[f]),P?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(b,{}),e.jsx("p",{className:"mt-4",children:"Cargando lección..."})]}):g?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:g})]}):l?e.jsx("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-4xl mx-auto border border-border-color",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary mb-4",children:l.title}),e.jsx("p",{className:"text-lg text-text-secondary mb-6",children:l.description}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary mb-3",children:"Contenido de la Lección"}),e.jsxs("div",{className:"flex flex-col items-center",children:[p?e.jsx(G,{file:p,onLoadSuccess:w,onLoadError:s=>{console.error("Error loading PDF document:",s),a(`No se pudo cargar el documento PDF: ${s.message}`)},className:"w-full max-w-full overflow-auto border border-border-color",children:e.jsx(I,{pageNumber:n,width:Math.min(window.innerWidth*.8,800)})}):e.jsx(b,{}),o&&e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-4",children:[e.jsx(N,{onClick:S,disabled:n<=1,children:"Página Anterior"}),e.jsxs("p",{className:"text-text-primary",children:["Página ",n," de ",o]}),e.jsx(N,{onClick:C,disabled:n>=o,children:"Página Siguiente"})]})]})]})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Lección No Encontrada"}),e.jsx("p",{className:"text-lg",children:"La lección que buscas no está disponible o no tienes permiso para verla."})]})};export{V as default};
