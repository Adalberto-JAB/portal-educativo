import{b as k,u as q,a as D,r as l,y as a,j as e,L as N}from"./index-CDtZe3id.js";import{u as P}from"./index.esm-CYe7NKTW.js";import{o as z,c as B,d as I,e as O,a as v}from"./index.esm-DVNFl3iM.js";import{l as E}from"./lessonService-DhDsuAxs.js";import{c as R}from"./courseService-BSeO5xSq.js";import{C as F}from"./CustomButton-BHk0TsfB.js";const T=B().shape({title:v().required("El título es requerido."),description:v().required("La descripción es requerida."),order:O().typeError("El orden debe ser un número.").required("El orden es requerido.").positive("El orden debe ser un número positivo.").integer("El orden debe ser un número entero."),pdfFile:I().nullable().test("fileType","Solo se permiten archivos PDF.",r=>!r||r&&r[0]&&r[0].type==="application/pdf").test("fileSize","El archivo es demasiado grande (máx. 5MB). ",r=>!r||r&&r[0]&&r[0].size<=5*1024*1024)}),K=()=>{const{courseId:r,lessonId:p}=k(),o=q(),{user:x,isAuthenticated:u,hasRole:f}=D(),[d,n]=l.useState(!0),[h,g]=l.useState(null),[w,S]=l.useState(null),{register:c,handleSubmit:C,formState:{errors:i},setValue:m,watch:L}=P({resolver:z(T)}),b=f(["admin","teacher"]),y=f(["admin"]);L("pdfFile");const j=l.useCallback(async()=>{if(!u||!b){a.error("No tienes permiso para editar lecciones."),o("/admin/courses");return}try{n(!0);const t=await E.getLessonById(p),s=await R.getCourseById(r),$=x&&s.author&&s.author._id===x.id;if(!y&&!$){a.error("No tienes permiso para editar esta lección."),o(`/admin/courses/${r}/edit`);return}m("title",t.title||""),m("description",t.description||""),m("order",t.order),S(t.pdfOriginalName||"N/A")}catch(t){console.error("Error fetching lesson data:",t),g(t.response?.data?.message||"Error al cargar la lección para edición."),a.error(t.response?.data?.message||"Error al cargar la lección para edición.")}finally{n(!1)}},[r,p,o,x,u,b,y,f,m]);l.useEffect(()=>{j()},[j]);const A=async t=>{if(!u||!b){a.error("No tienes permiso para editar lecciones.");return}n(!0);try{const s=new FormData;s.append("title",t.title),s.append("description",t.description),s.append("order",t.order),t.pdfFile&&t.pdfFile[0]&&s.append("pdfFile",t.pdfFile[0]),await E.updateLesson(p,s),a.success("Lección actualizada exitosamente."),o(`/admin/courses/${r}/edit`)}catch(s){console.error("Error updating lesson:",s),g(s.response?.data?.message||"Error al actualizar la lección."),a.error(s.response?.data?.message||"Error al actualizar la lección.")}finally{n(!1)}};return h?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:h})]}):d?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(N,{}),e.jsx("p",{className:"mt-4",children:"Cargando lección para edición..."})]}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Editar Lección"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:C(A),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"title",children:"Título:"}),e.jsx("input",{type:"text",id:"title",...c("title"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),i.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"description",children:"Descripción:"}),e.jsx("textarea",{id:"description",...c("description"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",rows:"4"}),i.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"order",children:"Orden:"}),e.jsx("input",{type:"number",id:"order",...c("order"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),i.order&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.order.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"pdfFile",children:["Archivo PDF (actual: ",w,"):"]}),e.jsx("input",{type:"file",id:"pdfFile",...c("pdfFile"),accept:".pdf",className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent-primary file:text-white hover:file:bg-blue-700"}),i.pdfFile&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.pdfFile.message})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(F,{variant:"secondary",onClick:()=>o(`/admin/courses/${r}/edit`),disabled:d,children:"Cancelar"}),e.jsx(F,{variant:"primary",type:"submit",disabled:d,children:d?e.jsx(N,{}):"Guardar Cambios"})]})]})})]})};export{K as default};
