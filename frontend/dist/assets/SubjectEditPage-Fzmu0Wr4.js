import{b as E,u as w,a as C,r as l,j as e,L as j,y as o}from"./index-CDtZe3id.js";import{s as h}from"./subjectService-FmAgODbn.js";import{g as q}from"./subjectAreaService-jrsNmA5G.js";import{C as f}from"./CustomButton-BHk0TsfB.js";import{u as k}from"./index.esm-CYe7NKTW.js";import{o as D,c as F,a as g}from"./index.esm-DVNFl3iM.js";const I=F().shape({name:g().required("El nombre de la materia es requerido"),subjectArea:g().required("El área de conocimiento es requerida")}),R=()=>{const{id:n}=E(),u=w(),{hasRole:y}=C(),[s,t]=l.useState(!0),[p,m]=l.useState(null),[N,v]=l.useState([]),{register:b,handleSubmit:A,formState:{errors:i},setValue:d}=k({resolver:D(I)}),c=y(["admin"]);l.useEffect(()=>{(async()=>{if(!c){t(!1),m("No tienes permiso para editar materias.");return}try{t(!0);const[a,x]=await Promise.all([q(),h.getSubjectById(n)]);v(a),d("name",x.name),x.subjectArea&&d("subjectArea",x.subjectArea._id),m(null)}catch(a){console.error("Error fetching data for edit:",a),m("No se pudo cargar la información para edición."),o.error("Error al cargar los datos.")}finally{t(!1)}})()},[n,c,d]);const S=async r=>{if(!c){o.error("No tienes permiso para modificar materias.");return}try{t(!0),await h.updateSubject(n,r),o.success("Materia actualizada exitosamente."),u("/admin/subjects")}catch(a){console.error("Error updating subject:",a),o.error(a.response?.data?.message||"Error al actualizar la materia.")}finally{t(!1)}};return s?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(j,{}),e.jsx("p",{className:"mt-4",children:"Cargando materia para edición..."})]}):p?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:p})]}):c?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center w-full",children:"Editar Materia"}),e.jsx("div",{className:"bg-bg-secondary p-8 rounded-lg shadow-lg w-full max-w-md mx-auto border border-border-color",children:e.jsxs("form",{onSubmit:A(S),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"name",children:"Nombre de la Materia:"}),e.jsx("input",{type:"text",id:"name",...b("name"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border"}),i.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-text-primary text-sm font-bold mb-2",htmlFor:"subjectArea",children:"Área de Conocimiento:"}),e.jsxs("select",{id:"subjectArea",...b("subjectArea"),className:"w-full px-3 py-2 border rounded-md bg-input-bg text-text-primary border-input-border",children:[e.jsx("option",{value:"",children:"Selecciona un área"}),N.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),i.subjectArea&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.subjectArea.message})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(f,{variant:"secondary",onClick:()=>u("/admin/subjects"),disabled:s,children:"Cancelar"}),e.jsx(f,{variant:"primary",type:"submit",disabled:s,children:s?e.jsx(j,{}):"Guardar Cambios"})]})]})})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para editar materias."})]})};export{R as default};
