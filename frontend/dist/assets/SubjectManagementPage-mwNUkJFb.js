import{u as k,r as s,a as M,j as e,L as A,Q as B,J as L,K as F,y as I}from"./index-CDtZe3id.js";import{s as N}from"./subjectService-FmAgODbn.js";import{C as p}from"./CustomButton-BHk0TsfB.js";import{S as u}from"./sweetalert2.esm.all-CH_YVA8w.js";const R=()=>{const j=k(),[a,y]=s.useState([]),[v,r]=s.useState(!0),[g,l]=s.useState(null),{hasRole:w}=M(),[i,o]=s.useState(1),[n,C]=s.useState(10),d=w(["admin"]),b=async()=>{try{r(!0);const h=(await N.getSubjects()).sort((c,E)=>c.name.localeCompare(E.name));y(h),l(null)}catch(t){console.error("Error fetching subjects:",t),l("No se pudieron cargar las materias. Por favor, inténtalo de nuevo más tarde."),I.error("Error al cargar las materias.")}finally{r(!1)}};s.useEffect(()=>{d?b():(r(!1),l("No tienes permiso para ver esta página."))},[d]);const P=t=>{u.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, ¡eliminar!",cancelButtonText:"Cancelar"}).then(async h=>{if(h.isConfirmed)try{r(!0),await N.deleteSubject(t),u.fire("¡Eliminado!","La materia ha sido eliminada.","success"),b()}catch(c){console.error("Error deleting subject:",c),u.fire("Error",c.response?.data?.message||"Error al eliminar la materia.","error")}finally{r(!1)}})},m=i*n,f=m-n,S=a.slice(f,m),x=Math.ceil(a.length/n);return v?e.jsxs("div",{className:"pt-20 flex flex-col items-center justify-center min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:[e.jsx(A,{}),e.jsx("p",{className:"mt-4",children:"Cargando materias..."})]}):g?e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Error"}),e.jsx("p",{className:"text-lg",children:g})]}):d?e.jsx("div",{className:"mt-28 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary",children:e.jsxs("div",{className:"max-w-[1024px] mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-center w-full mb-4",children:"Gestión de Materias"}),e.jsx("div",{className:"flex justify-end-safe mb-8",children:e.jsxs(p,{variant:"primary",onClick:()=>j("/admin/subjects/create"),children:[e.jsx(B,{className:"inline-block mr-2"})," Crear Nueva Materia"]})}),a.length===0?e.jsx("div",{className:"text-center text-text-secondary",children:e.jsx("p",{children:"No hay materias disponibles en este momento."})}):e.jsxs("div",{className:"bg-bg-secondary p-6 rounded-lg shadow-md border border-border-color",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"Listado de Materias"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"mr-2",children:"Items por página:"}),e.jsxs("select",{id:"itemsPerPage",value:n,onChange:t=>{C(Number(t.target.value)),o(1)},className:"bg-bg-secondary border border-border-color rounded-md p-1",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-color",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Área de Conocimiento"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-bg-secondary divide-y divide-border-color",children:S.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-primary",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-secondary",children:t.subjectArea?.name||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("a",{onClick:()=>j(`/admin/subjects/edit/${t._id}`),className:"text-accent-primary hover:text-blue-700 mr-3 cursor-pointer",children:e.jsx(L,{className:"inline-block mr-1"})}),e.jsx("button",{onClick:()=>P(t._id),className:"text-red-600 hover:text-red-900",children:e.jsx(F,{className:"inline-block mr-1"})})]})]},t._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-text-secondary",children:["Mostrando ",f+1," a ",Math.min(m,a.length)," de ",a.length," materias"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{onClick:()=>o(t=>Math.max(t-1,1)),disabled:i===1,variant:"secondary",children:"Anterior"}),e.jsxs("span",{className:"mx-4",children:["Página ",i," de ",x]}),e.jsx(p,{onClick:()=>o(t=>Math.min(t+1,x)),disabled:i===x,variant:"secondary",children:"Siguiente"})]})]})]})]})}):e.jsxs("div",{className:"pt-20 p-8 min-h-[calc(100vh-80px)] bg-bg-primary text-text-primary text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-red-500",children:"Acceso Denegado"}),e.jsx("p",{className:"text-lg",children:"No tienes permiso para ver esta página."})]})};export{R as default};
